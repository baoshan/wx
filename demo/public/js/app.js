// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var render_subscribers, scrolled, sync_buttons, template_buttons;
    $(document.body).scrollspy({
      target: '#div_affix',
      offset: 200
    });
    smoothScroll.init({
      speed: 500,
      easing: 'easeInOutCubic',
      offset: 0,
      updateURL: false
    });
    $('.hover_tip').hover(function() {
      return $(this).tooltip('toggle');
    });
    $("[href='#code_redis_options']").click(function(event) {
      event.preventDefault();
      return $('#code_redis_options').slideDown();
    });
    scrolled = false;
    $(window).scroll(function() {
      if (scrolled) {
        return;
      }
      scrolled = true;
      return setTimeout(function() {
        var scroll_top;
        scrolled = false;
        scroll_top = $(window).scrollTop();
        return $('.page').each(function() {
          if (scroll_top > $(this).prev().position().top + 120) {
            $(this).addClass('scrolled_to');
            if ($(this).is('#div_subscribe_list')) {
              if (!render_subscribers.rendered) {
                render_subscribers();
              }
              return render_subscribers.rendered = true;
            }
          }
        });
      }, 400);
    });
    $('#qrcode_home').scan(function() {
      console.log('home');
      return setTimeout(function() {
        return $('body, html').animate({
          scrollTop: $('#div_home').height()
        });
      }, 2400);
    });
    $('#登录二维码').scan(function(user) {
      var $img, src, title;
      src = user.headimgurl, title = user.nickname;
      $img = $("<img src='" + src + "' /><p>" + title + "</p>");
      $(this).replaceWith($img);
      return setTimeout(((function(_this) {
        return function() {
          return $img.parent().addClass('loggedin');
        };
      })(this)), 4000);
    });
    $('.临时二维码').scan(function() {});
    $('#永久二维码').scan(function(_arg) {
      var $img, src, title;
      title = _arg.nickname, src = _arg.headimgurl;
      $img = $("<img src='" + src + "' title='" + title + "' />");
      $('#div_headimgs').append($img);
      return $img.load(function() {
        return $(this).addClass('loaded');
      });
    });
    template_buttons = $('#template_div_buttons').html();
    (sync_buttons = function() {
      var json;
      console.log(Mustache.render(template_buttons, markdown_2_json($('#textarea_markdown').val())));
      json = markdown_2_json($('#textarea_markdown').val());
      $('#div_buttons').html(Mustache.render(template_buttons, json));
      return $('#div_edit_button_demo_code code').html(JSON.stringify(json, null, '  '));
    })();
    $('#textarea_markdown').on('input', sync_buttons);
    return render_subscribers = function() {
      var headimgurl, i, randoms, _i, _j, _len, _results, _results1;
      randoms = (function() {
        _results = [];
        for (_i = 0; _i < 100; _i++){ _results.push(_i); }
        return _results;
      }).apply(this).sort(function() {
        if (Math.random() > 0.5) {
          return 1;
        } else {
          return -1;
        }
      });
      $("#div_subscribe_list.page .bottom .row").append(Array(101).join("<div class='col-md-1' />"));
      _results1 = [];
      for (i = _j = 0, _len = headimgurls.length; _j < _len; i = ++_j) {
        headimgurl = headimgurls[i];
        _results1.push((function(headimgurl, i) {
          return setTimeout(function() {
            var selector;
            selector = "#div_subscribe_list.page .bottom .row > div:nth-child(" + randoms[i] + ")";
            $(selector).css('background-image', "url(" + headimgurl + ")");
            return setTimeout(function() {
              return $(selector).addClass('loaded');
            }, 500);
          }, i * 500);
        })(headimgurl, i));
      }
      return _results1;
    };
  });

}).call(this);
